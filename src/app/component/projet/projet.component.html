



<app-navbar 
	[isSidebarOpen]="isSidebarOpen" 
	[sidebarWidth]="220" 
	[sidebarClosedWidth]="70">
</app-navbar>

<div class="layout" [class.sidebar-closed]="!isSidebarOpen">
	<app-sidebar (toggle)="isSidebarOpen = $event"></app-sidebar>
	<main class="content">
		<!-- Page Header -->
		<div class="page-header">
			<div class="header-left">
				<div class="header-icon">
					<i class="bi bi-folder"></i>
				</div>
				<div>
					<h1 class="page-title">Projets</h1>
					<p class="page-subtitle">{{ filteredProjets.length }} projet(s) trouvé(s)</p>
				</div>
			</div>
			<button class="add-btn" (click)="openAddProjetModal()">
				<i class="bi bi-plus-lg"></i>
				<span>Ajouter un projet</span>
			</button>
		</div>

		<div *ngIf="error" class="alert alert-danger">{{ error }}</div>

		<!-- Toolbar -->
		<div class="toolbar-section">
			<div class="search-box">
				<i class="bi bi-search"></i>
				<input 
					type="text" 
					class="search-input" 
					placeholder="Rechercher par nom, produit ou navire..." 
					[(ngModel)]="projetFilter" 
					(input)="applyFilter()"
				/>
			</div>
			<div class="toolbar-right">
				<span class="results-count">{{ filteredProjets.length }} résultat(s)</span>
				<div class="page-size-selector">
					<span>Afficher</span>
					<select [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="page-size-select">
						<option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
					</select>
					<span>projets</span>
				</div>
			</div>
		</div>

		<!-- Liste des projets en cards -->
		<div class="row g-4 mb-4">
			<div *ngFor="let pr of paginatedProjets" class="col-md-6 col-lg-4">
				<div class="projet-card" [class.active-project]="pr.active">
					<!-- Header avec gradient -->
					<div class="projet-card-header">
						<a class="projet-card-settings" [routerLink]="['/projet', pr.id, 'parametre']" title="Paramètres">
							<i class="bi bi-gear"></i>
						</a>
						<!-- Badge Projet Actif -->
						<div class="active-badge" *ngIf="pr.active">
							<i class="bi bi-check-circle-fill"></i>
							<span>Actif</span>
						</div>
						<h5 class="projet-card-title" [class.mt-5]="pr.active">{{ pr.nom }}</h5>
						<p class="projet-card-subtitle">{{ pr.nomProduit }}</p>
					</div>

					<!-- Body avec informations -->
					<div class="projet-card-body">
						<div class="projet-info-item">
							<span class="projet-info-label">Quantité</span>
							<span class="projet-info-value">{{ pr.quantiteTotale }}</span>
						</div>
						<div class="projet-info-item">
							<span class="projet-info-label">Navire</span>
							<span class="projet-info-value">{{ pr.nomNavire || 'Non défini' }}</span>
						</div>
						<!-- <div class="projet-info-item">
							<span class="projet-info-label">Pays</span>
							<span class="projet-info-value">{{ pr.paysNavire || 'Non défini' }}</span>
						</div> -->
						<div class="projet-info-item" *ngIf="pr.port">
							<span class="projet-info-label">Port</span>
							<span class="projet-info-value">{{ pr.port }}</span>
						</div>
						<!-- <div class="projet-info-item">
							<span class="projet-info-label">État</span>
							<span class="projet-badge" [ngClass]="{
								'en-attente': pr.etat === 'En attente',
								'en-cours': pr.etat === 'En cours',
								'termine': pr.etat === 'Terminé'
							}">
								<i class="bi" [ngClass]="{
									'bi-clock': pr.etat === 'En attente',
									'bi-arrow-repeat': pr.etat === 'En cours',
									'bi-check-circle': pr.etat === 'Terminé'
								}"></i>
								{{ pr.etat }}
							</span>
						</div> -->
					</div>

					<!-- Actions -->
					<div class="projet-card-actions">
						<button class="projet-action-btn edit" (click)="openEditProjetModal(pr)">
							<i class="bi bi-pencil"></i>
							Modifier
						</button>
						<button class="projet-action-btn delete" (click)="deleteProjet(pr.id)">
							<i class="bi bi-trash"></i>
							Supprimer
						</button>
					</div>
				</div>
			</div>
			<div *ngIf="paginatedProjets.length === 0" class="col-12">
				<div class="no-data">
					<i class="bi bi-inbox" style="font-size: 48px; opacity: 0.5;"></i>
					<p style="margin: 0; font-size: 16px; font-weight: 500; color: #94a3b8;">Aucun projet trouvé</p>
				</div>
			</div>
		</div>

		<!-- Pagination -->
		<div class="pagination-container" *ngIf="filteredProjets.length > 0">
			<div class="pagination-info">
				Affichage de {{ (currentPage - 1) * pageSize + 1 }} à {{ Math.min(currentPage * pageSize, filteredProjets.length) }} sur {{ filteredProjets.length }} projet(s)
			</div>
			<div class="pagination-controls">
				<button class="page-btn" (click)="goToPage(1)" [disabled]="currentPage === 1">
					<i class="bi bi-chevron-double-left"></i>
				</button>
				<button class="page-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
					<i class="bi bi-chevron-left"></i>
				</button>
				<button 
					*ngFor="let page of getPageNumbers()" 
					class="page-btn" 
					[class.active]="page === currentPage"
					(click)="goToPage(page)"
				>
					{{ page }}
				</button>
				<button class="page-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
					<i class="bi bi-chevron-right"></i>
				</button>
				<button class="page-btn" (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
					<i class="bi bi-chevron-double-right"></i>
				</button>
			</div>
		</div>

		<!-- Modal Ajout Projet -->
		<div class="modal fade" id="addProjetModal" tabindex="-1" aria-labelledby="addProjetModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-header bg-success text-white">
						<h5 class="modal-title" id="addProjetModalLabel">Ajouter un projet</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form (ngSubmit)="addProjet(); closeAddProjetModal()" #addProjetForm="ngForm">
							<div class="mb-3">
								<label for="nom" class="form-label">Société</label>
								<input [(ngModel)]="newProjet.nom" name="nom" id="nom" class="form-control" required />
							</div>
							<div class="mb-3">
								<label for="port" class="form-label">Port</label>
								<input [(ngModel)]="newProjet.port" name="port" id="port" class="form-control" placeholder="Nom du port" />
							</div>
							<div class="mb-3">
								<label for="nomProduit" class="form-label">Produit</label>
								<input [(ngModel)]="newProjet.nomProduit" name="nomProduit" id="nomProduit" class="form-control" required />
							</div>
							<div class="mb-3">
								<label for="nomNavire" class="form-label">Navire</label>
								<input [(ngModel)]="newProjet.nomNavire" name="nomNavire" id="nomNavire" class="form-control" />
							</div>
							<!-- Section Déclarations -->
							<div class="mb-3">
								<label class="form-label fw-bold">
									<i class="bi bi-file-text"></i> Déclarations
								</label>
								<div *ngFor="let declaration of declarations; let i = index" class="declaration-item mb-2">
									<div class="card border-secondary">
										<div class="card-body p-3">
											<div class="row align-items-center">
												<div class="col-md-5">
													<label class="form-label small">Numéro de déclaration</label>
													<input 
														[(ngModel)]="declaration.numeroDeclaration" 
														[name]="'numDeclaration' + i" 
														type="text" 
														class="form-control form-control-sm" 
														placeholder="Ex: DEC-2024-001" />
												</div>
												<div class="col-md-5">
													<label class="form-label small">Quantité manifestée (T)</label>
													<input 
														[(ngModel)]="declaration.quantiteManifestee" 
														[name]="'quantiteDeclaration' + i" 
														type="number" 
														step="0.01"
														min="0"
														class="form-control form-control-sm" 
														placeholder="Ex: 1500.50" />
												</div>
												<div class="col-md-2 text-end">
													<button 
														*ngIf="declarations.length > 1" 
														type="button" 
														class="btn btn-sm btn-outline-danger mt-4" 
														(click)="supprimerDeclaration(i)"
														title="Supprimer">
														<i class="bi bi-trash"></i>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<button type="button" class="btn btn-sm btn-outline-primary mt-2" (click)="ajouterDeclaration()">
									<i class="bi bi-plus-circle"></i> Ajouter une déclaration
								</button>
							<div class="mb-3">
								<label for="quantiteTotale" class="form-label">Quantité</label>
								<input [(ngModel)]="newProjet.quantiteTotale" name="quantiteTotale" id="quantiteTotale" type="number" class="form-control" required />
							</div>
							
							<!-- <div class="mb-3">
								<label for="paysNavire" class="form-label hidden">Pays</label>
								<input [(ngModel)]="newProjet.paysNavire" name="paysNavire" value="fr" id="paysNavire" class="form-control" />
							</div>
							<div class="mb-3">
								<label for="etat" class="form-label hidden">Etat</label>
								<input [(ngModel)]="newProjet.etat" name="etat" id="etat" value="ter" class="form-control" />
							</div> -->
							
							<div class="mb-3">
								<label for="dateDebut" class="form-label">Date début</label>
								<input [(ngModel)]="newProjet.dateDebut" name="dateDebut" id="dateDebut" type="date" class="form-control" />
							</div>
							<div class="mb-3">
								<label for="dateFin" class="form-label">Date fin</label>
								<input [(ngModel)]="newProjet.dateFin" name="dateFin" id="dateFin" type="date" class="form-control" />
							</div>
							
							</div>
							
							<div class="form-check form-switch mb-3">
								<input class="form-check-input" type="checkbox" id="active" [(ngModel)]="newProjet.active" name="active">
								<label class="form-check-label" for="active">Projet actif</label>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
								<button type="submit" class="btn btn-success">Ajouter</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal Edition Projet -->
		<div class="modal fade" id="editProjetModal" tabindex="-1" aria-labelledby="editProjetModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header bg-primary text-white">
						<h5 class="modal-title" id="editProjetModalLabel">Modifier le projet</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form (ngSubmit)="updateProjet(); closeEditProjetModal()" *ngIf="selectedProjet" #editProjetForm="ngForm">
							<div class="mb-3">
								<label for="editNom" class="form-label">Nom</label>
								<input [(ngModel)]="selectedProjet.nom" name="editNom" id="editNom" class="form-control" required />
							</div>
							<div class="mb-3">
								<label for="editNomProduit" class="form-label">Produit</label>
								<input [(ngModel)]="selectedProjet.nomProduit" name="editNomProduit" id="editNomProduit" class="form-control" required />
							</div>
							<div class="mb-3">
								<label for="editQuantiteTotale" class="form-label">Quantité</label>
								<input [(ngModel)]="selectedProjet.quantiteTotale" name="editQuantiteTotale" id="editQuantiteTotale" type="number" class="form-control" required />
							</div>
							<div class="mb-3">
								<label for="editNomNavire" class="form-label">Navire</label>
								<input [(ngModel)]="selectedProjet.nomNavire" name="editNomNavire" id="editNomNavire" class="form-control" />
							</div>
							<!-- <div class="mb-3">
								<label for="editPaysNavire" class="form-label">Pays</label>
								<input [(ngModel)]="selectedProjet.paysNavire" name="editPaysNavire" id="editPaysNavire" class="form-control" />
							</div>
							<div class="mb-3">
								<label for="editEtat" class="form-label">Etat</label>
								<input [(ngModel)]="selectedProjet.etat" name="editEtat" id="editEtat" class="form-control" />
							</div> -->
							<div class="mb-3">
								<label for="editPort" class="form-label">Port</label>
								<input [(ngModel)]="selectedProjet.port" name="editPort" id="editPort" class="form-control" placeholder="Nom du port" />
							</div>
							<div class="mb-3">
								<label for="editDateDebut" class="form-label">Date début</label>
								<input [(ngModel)]="selectedProjet.dateDebut" name="editDateDebut" id="editDateDebut" type="date" class="form-control" />
							</div>
							<div class="mb-3">
								<label for="editDateFin" class="form-label">Date fin</label>
								<input [(ngModel)]="selectedProjet.dateFin" name="editDateFin" id="editDateFin" type="date" class="form-control" />
							</div>
							<div class="form-check form-switch mb-3">
								<input class="form-check-input" type="checkbox" id="editActive" [(ngModel)]="selectedProjet.active" name="editActive">
								<label class="form-check-label" for="editActive">Projet actif</label>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
								<button type="submit" class="btn btn-primary">Enregistrer</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</main>
</div>
