<app-navbar [isSidebarOpen]="isSidebarOpen" [sidebarWidth]="220" [sidebarClosedWidth]="70"></app-navbar>
<div class="layout" [class.sidebar-closed]="!isSidebarOpen">
  <app-sidebar (toggle)="isSidebarOpen = $event"></app-sidebar>
  <main class="content">
    <!-- Breadcrumb Navigation -->
    <app-breadcrumb [items]="breadcrumbItems" [showBackButton]="true"></app-breadcrumb>
    
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <div class="header-icon">
          <i class="bi bi-boxes"></i>
        </div>
        <div>
          <h1 class="page-title">Dépôts</h1>
          <p class="page-subtitle">{{ filteredDepots.length }} dépôt(s) trouvé(s)</p>
        </div>
      </div>
      <button class="add-btn" (click)="openAddDialog()" [disabled]="!canAddData()" [title]="!canAddData() ? 'Ce projet n\'est pas actif' : 'Ajouter un nouveau dépôt'">
        <i class="bi bi-plus-lg"></i>
        <span>Ajouter un dépôt</span>
      </button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar-section">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Rechercher par nom..." 
          [(ngModel)]="depotFilter" 
          (input)="applyFilter()"
        />
      </div>
      <div class="toolbar-right">
        <span class="results-count">{{ filteredDepots.length }} résultat(s)</span>
        <div class="page-size-selector">
          <span>Afficher</span>
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="page-size-select">
            <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
          </select>
          <span>lignes</span>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="table-container">
      <table class="modern-table">
        <thead>
          <tr>
            <th class="sortable" (click)="sortBy('nom')">
              <div class="th-content">
                <span>Nom</span>
                <i class="bi" [ngClass]="{
                  'bi-chevron-down': sortColumn === 'nom' && sortDirection === 'desc',
                  'bi-chevron-up': sortColumn === 'nom' && sortDirection === 'asc',
                  'bi-chevron-expand': sortColumn !== 'nom'
                }"></i>
              </div>
            </th>
            <th class="actions-header text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let dep of paginatedDepots" class="table-row">
            <td>
              <i class="bi bi-box-seam" style="margin-right: 8px; color: #6366f1;"></i>
              {{ dep.nom }}
            </td>
            <td class="actions-cell">
              <button class="action-btn edit-btn" (click)="selectDepot(dep)" [disabled]="!canAddData()" [title]="!canAddData() ? 'Ce projet n\'est pas actif' : 'Modifier'">
                <i class="bi bi-pencil-fill"></i>
              </button>
              <button class="action-btn delete-btn" (click)="deleteDepot(dep.id)" [disabled]="!canAddData()" [title]="!canAddData() ? 'Ce projet n\'est pas actif' : 'Supprimer'">
                <i class="bi bi-trash-fill"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="paginatedDepots.length === 0" class="no-data-row">
            <td colspan="2">
              <div class="no-data">
                <i class="bi bi-inbox"></i>
                <p>Aucun dépôt trouvé</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="filteredDepots.length > 0">
      <div class="pagination-info">
        Affichage de {{ (currentPage - 1) * pageSize + 1 }} à {{ Math.min(currentPage * pageSize, filteredDepots.length) }} sur {{ filteredDepots.length }} dépôt(s)
      </div>
      <div class="pagination-controls">
        <button class="page-btn" (click)="goToPage(1)" [disabled]="currentPage === 1">
          <i class="bi bi-chevron-double-left"></i>
        </button>
        <button class="page-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
          <i class="bi bi-chevron-left"></i>
        </button>
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="page-btn" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        <button class="page-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
          <i class="bi bi-chevron-right"></i>
        </button>
        <button class="page-btn" (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
          <i class="bi bi-chevron-double-right"></i>
        </button>
      </div>
    </div>

    <!-- Dialog modal -->
    <div class="dialog-backdrop" *ngIf="showAddDialog || editMode" (click)="closeDialog()">
      <div class="dialog-modal" (click)="$event.stopPropagation()">
        <h3>{{ editMode ? 'Modifier le dépôt' : 'Ajouter un dépôt' }}</h3>
        <input [(ngModel)]="dialogDepot.nom" placeholder="Nom du dépôt" />
        <div class="dialog-actions">
          <button *ngIf="!editMode" (click)="addDialogDepot()" [disabled]="!canAddData()">Ajouter</button>
          <button *ngIf="editMode" (click)="updateDialogDepot()" [disabled]="!canAddData()">Enregistrer</button>
          <button (click)="closeDialog()">Annuler</button>
        </div>
      </div>
    </div>
  </main>
</div>
